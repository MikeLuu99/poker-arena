<!doctype html>
<html>
    <head>
        <title>Poker Arena</title>
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
                background: #ffffff;
                color: #333333;
                min-height: 100vh;
            }

            .game-container {
                display: grid;
                grid-template-columns: 1fr 3fr;
                gap: 20px;
                margin-top: 40px;
            }

            @media (max-width: 1200px) {
                .game-container {
                    grid-template-columns: 1fr;
                    gap: 30px;
                }

                .game-main {
                    margin: 50px 20px;
                }

                .game-log {
                    margin-top: 0;
                }

                .log-entries {
                    height: 400px;
                }
            }

            @media (max-width: 768px) {
                body {
                    padding: 10px;
                }

                .game-main {
                    margin: 20px 10px;
                }

                .player-card {
                    width: 180px;
                    padding: 12px;
                }

                .card {
                    width: 35px;
                    height: 50px;
                    line-height: 50px;
                    font-size: 10px;
                }

                .table-center {
                    width: 280px;
                    padding: 20px;
                }

                .pot-amount {
                    font-size: 1.5em;
                }
            }

            .game-main {
                position: relative;
                aspect-ratio: 4/3;
                background: #f8f9fa;
                border-radius: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                border: 1px solid #e9ecef;
                margin: 100px 40px;
            }

            .table-center {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
                background: #ffffff;
                padding: 25px;
                border-radius: 15px;
                width: 320px;
                border: 1px solid #dee2e6;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .community-cards {
                margin-bottom: 15px;
            }

            .pot-amount {
                font-size: 1.8em;
                color: #28a745;
                font-weight: 600;
                letter-spacing: 0.5px;
            }

            .players-circle {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            .player-card {
                position: absolute;
                background: #ffffff;
                padding: 18px;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                width: 220px;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
                border: 1px solid #e9ecef;
                color: #333;
            }

            .player-card:hover {
                transform: translate(-50%, -50%) scale(1.02);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }

            .player-card.active {
                border: 2px solid #007bff;
                background: #f8f9fa;
                box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
            }


            .player-bet {
                position: absolute;
                color: #007bff;
                background: #ffffff;
                padding: 6px 12px;
                border-radius: 15px;
                font-weight: 600;
                transform: translate(-50%, -50%);
                border: 1px solid #dee2e6;
                font-size: 0.85em;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }


            .card {
                display: inline-block;
                width: 45px;
                height: 65px;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                margin: 0 6px;
                text-align: center;
                line-height: 65px;
                background: #ffffff;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                font-weight: 600;
                font-size: 12px;
                transition: transform 0.2s ease;
            }

            .card:hover {
                transform: translateY(-1px);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            }

            .card.red {
                color: #d32f2f;
            }

            .card.black {
                color: #000000;
            }

            .game-info {
                text-align: center;
                font-size: 1.1em;
                background: #ffffff;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                position: absolute;
                top: -100px;
                left: 0;
                right: 0;
                color: #333;
                font-weight: 500;
                border: 1px solid #e9ecef;
            }

            .game-log {
                background: #ffffff;
                padding: 25px;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                height: 100%;
                margin-top: 100px;
                border: 1px solid #e9ecef;
            }

            .game-log h2 {
                color: #333;
                margin-top: 0;
                font-size: 1.3em;
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 1px solid #e9ecef;
                font-weight: 500;
            }

            .log-entries {
                height: 600px;
                overflow-y: auto;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                font-size: 0.9em;
                line-height: 1.5;
                background: #f8f9fa;
                border-radius: 6px;
                padding: 15px;
                border: 1px solid #e9ecef;
            }

            .log-entries::-webkit-scrollbar {
                width: 6px;
            }

            .log-entries::-webkit-scrollbar-track {
                background: #f8f9fa;
                border-radius: 3px;
            }

            .log-entries::-webkit-scrollbar-thumb {
                background: #dee2e6;
                border-radius: 3px;
            }

            .log-entries::-webkit-scrollbar-thumb:hover {
                background: #adb5bd;
            }

            .log-entry {
                padding: 6px 0;
                border-bottom: 1px solid #e9ecef;
                color: #495057;
                transition: background-color 0.2s ease;
            }

            .log-entry:hover {
                background-color: #ffffff;
                border-radius: 3px;
                margin: 0 -8px;
                padding: 6px 8px;
            }

            .log-entry:last-child {
                border-bottom: none;
            }
        </style>
    </head>
    <body>
        <h1
            style="
                text-align: center;
                color: #333;
                font-size: 2.5em;
                margin-bottom: 30px;
                font-weight: 600;
            "
        >
            Poker Arena
        </h1>
        <div class="game-container">
            <div class="game-log">
                <h2>Game Log</h2>
                <div
                    class="log-entries"
                    id="gameLog"
                    hx-get="/game-state"
                    hx-trigger="every 2s"
                    hx-swap="none"
                    hx-on:htmx:after-request="updateGameLog(JSON.parse(event.detail.xhr.responseText))"
                ></div>
            </div>

            <div class="game-main">
                <div
                    class="game-info"
                    id="game-info"
                    hx-get="/game-state"
                    hx-trigger="every 2s"
                    hx-swap="none"
                    hx-on:htmx:after-request="updateGameInfo(JSON.parse(event.detail.xhr.responseText))"
                >
                    <span>Hand #<span id="handNumber">1</span></span> |
                    <span>Round: <span id="round">preflop</span></span>
                </div>
                <div
                    class="table-center"
                    id="table-center"
                    hx-get="/game-state"
                    hx-trigger="every 2s"
                    hx-swap="none"
                    hx-on:htmx:after-request="updateTableCenter(JSON.parse(event.detail.xhr.responseText))"
                >
                    <div class="community-cards" id="communityCards"></div>
                    <div class="pot-amount">Pot: $<span id="pot">0</span></div>
                </div>
                <div
                    class="players-circle"
                    id="players"
                    hx-get="/game-state"
                    hx-trigger="every 2s"
                    hx-swap="none"
                    hx-on:htmx:after-request="updatePlayers(JSON.parse(event.detail.xhr.responseText))"
                ></div>
            </div>
        </div>
        <p style="text-align: center; margin-top: 30px">
            <a
                href="https://github.com/MikeLuu99/poker-arena"
                style="
                    color: #007bff;
                    text-decoration: none;
                    font-size: 1em;
                    padding: 8px 16px;
                    border: 1px solid #007bff;
                    border-radius: 6px;
                    transition: all 0.3s ease;
                "
                onmouseover="this.style.backgroundColor='#007bff'; this.style.color='#fff';"
                onmouseout="this.style.backgroundColor='transparent'; this.style.color='#007bff';"
                >GitHub Source</a
            >
        </p>

        <script>
            function getSuitColor(card) {
                const suit = card.slice(-1);
                return suit === "♥" || suit === "♦" ? "red" : "black";
            }

            function getPlayerPosition(index, total) {
                const angle = ((index * 360) / total - 90) * (Math.PI / 180);
                const radiusX = 45;
                const radiusY = 42;

                const x = 50 + radiusX * Math.cos(angle);
                const y = 50 + radiusY * Math.sin(angle);

                return { x, y };
            }

            function getBetPosition(index, total) {
                const angle = ((index * 360) / total - 90) * (Math.PI / 180);
                const radiusX = 32; // Closer to center than player cards
                const radiusY = 30;

                const x = 50 + radiusX * Math.cos(angle);
                const y = 50 + radiusY * Math.sin(angle);

                return { x, y };
            }

            function updateGameInfo(gameState) {
                document.getElementById("handNumber").textContent =
                    gameState.handNumber;
                document.getElementById("round").textContent = gameState.round;
            }

            function updateTableCenter(gameState) {
                document.getElementById("pot").textContent = gameState.pot;

                // Update community cards
                const communityCardsEl =
                    document.getElementById("communityCards");
                communityCardsEl.innerHTML = gameState.communityCards
                    .map(
                        (card) =>
                            `<div class="card ${getSuitColor(card)}">${card}</div>`,
                    )
                    .join("");
            }

            function updatePlayers(gameState) {
                // Update players and their bets
                const playersEl = document.getElementById("players");
                const totalPlayers = gameState.players.length;

                // First add player cards
                playersEl.innerHTML = gameState.players
                    .map((player, index) => {
                        const pos = getPlayerPosition(index, totalPlayers);
                        const isEliminated =
                            gameState.eliminatedPlayers.includes(player.name);
                        const isFolded = gameState.foldedPlayers.includes(
                            player.name,
                        );
                        const isActive =
                            index === gameState.currentPlayer &&
                            !isEliminated &&
                            !isFolded;

                        return `
                        <div class="player-card ${isActive ? "active" : ""}"
                             style="left: ${pos.x}%; top: ${pos.y}%;">
                            <h3>${player.name} ${isFolded ? "(folded)" : ""} ${isEliminated ? "(eliminated)" : ""}</h3>
                            <div>Chips: $${player.chips}</div>
                            <div>Cards: ${player.cards
                                .map(
                                    (card) =>
                                        `<span class="card ${getSuitColor(card)}">${card}</span>`,
                                )
                                .join("")}</div>
                        </div>
                    `;
                    })
                    .join("");

                // Then add bet amounts
                gameState.players.forEach((player, index) => {
                    const bet = gameState.playerBets[player.name];
                    if (bet && bet > 0) {
                        const betPos = getBetPosition(index, totalPlayers);
                        const betEl = document.createElement("div");
                        betEl.className = "player-bet";
                        betEl.textContent = `$${bet}`;
                        betEl.style.left = `${betPos.x}%`;
                        betEl.style.top = `${betPos.y}%`;
                        playersEl.appendChild(betEl);
                    }
                });
            }

            function updateGameLog(gameState) {
                // Update game log - reverse order so most recent is at bottom
                const gameLogEl = document.getElementById("gameLog");
                gameLogEl.innerHTML = gameState.gameLog
                    .slice()
                    .reverse()
                    .map((entry) => `<div class="log-entry">${entry}</div>`)
                    .join("");
                // Auto-scroll to bottom to show most recent log
                gameLogEl.scrollTop = gameLogEl.scrollHeight;
            }
        </script>
    </body>
</html>
